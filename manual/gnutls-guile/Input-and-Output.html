<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- This manual is last updated 16 March 2016 for version
3.5.3 of GnuTLS.

Copyright (C) 2001-2012, 2014, 2016 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with no
Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.  A
copy of the license is included in the section entitled "GNU Free
Documentation License". -->
<!-- Created by GNU Texinfo 6.1, http://www.gnu.org/software/texinfo/ -->
<head>
<title>GnuTLS-Guile 3.5.3: Input and Output</title>

<meta name="description" content="GnuTLS-Guile 3.5.3: Input and Output">
<meta name="keywords" content="GnuTLS-Guile 3.5.3: Input and Output">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link href="index.html#Top" rel="start" title="Top">
<link href="Procedure-Index.html#Procedure-Index" rel="index" title="Procedure Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Guile-API-Conventions.html#Guile-API-Conventions" rel="up" title="Guile API Conventions">
<link href="Exception-Handling.html#Exception-Handling" rel="next" title="Exception Handling">
<link href="Representation-of-Binary-Data.html#Representation-of-Binary-Data" rel="prev" title="Representation of Binary Data">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
blockquote.smallindentedblock {margin-right: 0em; font-size: smaller}
blockquote.smallquotation {font-size: smaller}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
div.smalldisplay {margin-left: 3.2em}
div.smallexample {margin-left: 3.2em}
div.smalllisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: inherit; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: inherit; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
body { 
	margin: 2%;
	padding: 0 5%;
	background: #ffffff;
}
h1,h2,h3,h4,h5 {
    font-weight: bold;
    padding: 5px 5px 5px 5px;
    background-color: #c2e0ff;
    color: #336699;
}
h1 {
    padding: 2em 2em 2em 5%;
    color: white;
    background: #336699;
    text-align: center;
    letter-spacing: 3px;
}
h2 { text-decoration: underline; }
pre {
  margin: 0 5%;
  padding: 0.5em;
}
pre.example,pre.verbatim {
  padding-bottom: 1em;

  border: solid #c2e0ff;
  background: #f0faff;
  border-width: 1px 1px 1px 5px;
  margin: 1em auto;
  width: 90%;
}

div.node {
  margin: 0 -5% 0 -2%;
  padding: 0.5em 0.5em;
  margin-top: 0.5em;
  margin-bottom: 0.5em;
  font-weight: bold;
}
dd, li {
  padding-top: 0.1em;
  padding-bottom: 0.1em;
}
div.float {

  margin-bottom: 0.5em;
  text-align: center;
}

table {
  text-align: left;
  margin-left:auto;
  margin-right:auto;
  border-spacing: 7px;
  width: 50%;
}

th {
  padding: 0;
  color: #336699;
  background-color: #c2e0ff;
  border: solid #000000;
  border-width: 0px;
  margin: 1em auto;
  text-align: center;
  margin-left:auto;
  margin-right:auto;
}

td {
  padding: 0;
  border: solid #000000;
  background-color: #f0faff;
  border-width: 0px;
  margin: 1em auto;
  text-align: left;
  margin-left:auto;
  margin-right:auto;
  padding-left: 1em;
}

dl {
  text-align: left;
  margin-left:auto;
  margin-right:auto;
  width: 50%;

  padding-left: 1em;
  border: solid #c2e0ff;
  background: #f0faff;
  border-width: 5px 1px 1px 1px;
  margin: 1em auto;
}

-->
</style>


</head>

<body lang="en">
<a name="Input-and-Output"></a>
<div class="header">
<p>
Next: <a href="Exception-Handling.html#Exception-Handling" accesskey="n" rel="next">Exception Handling</a>, Previous: <a href="Representation-of-Binary-Data.html#Representation-of-Binary-Data" accesskey="p" rel="prev">Representation of Binary Data</a>, Up: <a href="Guile-API-Conventions.html#Guile-API-Conventions" accesskey="u" rel="up">Guile API Conventions</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Procedure-Index.html#Procedure-Index" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<a name="Input-and-Output-1"></a>
<h3 class="section">3.4 Input and Output</h3>

<a name="index-set_002dsession_002dtransport_002dport_0021"></a>
<a name="index-set_002dsession_002dtransport_002dfd_0021"></a>

<p>The underlying transport of a TLS session can be any Scheme
input/output port (see <a href="http://www.gnu.org/software/guile/manual/html_node/Ports-and-File-Descriptors.html#Ports-and-File-Descriptors">Ports and File Descriptors</a> in <cite>The GNU
Guile Reference Manual</cite>).  This has to be specified using
<code>set-session-transport-port!</code>.
</p>
<p>However, for better performance, a raw file descriptor can be
specified, using <code>set-session-transport-fd!</code>.  For instance, if
the transport layer is a socket port over an OS-provided socket, you
can use the <code>port-&gt;fdes</code> or <code>fileno</code> procedure to obtain the
underlying file descriptor and pass it to
<code>set-session-transport-fd!</code>  (see <a href="http://www.gnu.org/software/guile/manual/html_node/Ports-and-File-Descriptors.html#Ports-and-File-Descriptors"><code>port-&gt;fdes</code> and <code>fileno</code></a> in <cite>The GNU Guile Reference
Manual</cite>).  This would work as follows:
</p>
<div class="example">
<pre class="example">(let ((socket (socket PF_INET SOCK_STREAM 0))
      (session (make-session connection-end/client)))

  ;;
  ;; Establish a TCP connection...
  ;;

  ;; Use the file descriptor that underlies SOCKET.
  (set-session-transport-fd! session (fileno socket)))
</pre></div>

<a name="index-session_002drecord_002dport"></a>

<p>Once a TLS session is established, data can be communicated through it
(i.e., <em>via</em> the TLS record layer) using the port returned by
<code>session-record-port</code>:
</p>
<div class="example">
<pre class="example">(let ((session (make-session connection-end/client)))

  ;;
  ;; Initialize the various parameters of SESSION, set up
  ;; a network connection, etc.
  ;;

  (let ((i/o (session-record-port session)))
    (display &quot;Hello peer!&quot; i/o)
    (let ((greetings (read i/o)))

      ;; &hellip;

      (bye session close-request/rdwr))))
</pre></div>

<a name="index-buffering"></a>
<p>Note that each write to the session record port leads to the
transmission of an encrypted TLS &ldquo;Application Data&rdquo; packet.  In the
above example, we create an Application Data packet for the 11 bytes for
the string that we write.  This is not efficient both in terms of CPU
usage and bandwidth (each packet adds at least 5 bytes of overhead and
can lead to one <code>write</code> system call), so we recommend that
applications do their own buffering.
</p>
<a name="index-record_002dsend"></a>
<a name="index-record_002dreceive_0021"></a>

<p>A lower-level I/O API is provided by <code>record-send</code> and
<code>record-receive!</code> which take a bytevector (or a SRFI-4 vector) to
represent the data sent or received.  While it might improve
performance, it is much less convenient than the session record port and
should rarely be needed.
</p>

<hr>
<div class="header">
<p>
Next: <a href="Exception-Handling.html#Exception-Handling" accesskey="n" rel="next">Exception Handling</a>, Previous: <a href="Representation-of-Binary-Data.html#Representation-of-Binary-Data" accesskey="p" rel="prev">Representation of Binary Data</a>, Up: <a href="Guile-API-Conventions.html#Guile-API-Conventions" accesskey="u" rel="up">Guile API Conventions</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Procedure-Index.html#Procedure-Index" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
